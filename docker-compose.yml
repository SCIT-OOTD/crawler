

services:
  # 1. MySQL ë°ì´í„°ë² ì´ìŠ¤
  db:
    image: mysql:8.0
    container_name: mysql-container
    environment:
      MYSQL_ROOT_PASSWORD: 1234
      MYSQL_DATABASE: musinsa_db
      TZ: Asia/Seoul
    ports:
      - "3307:3306"
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    # ğŸ‘‡ [ì¶”ê°€ë¨] DBê°€ ì§„ì§œ ì¼œì¡ŒëŠ”ì§€ 2ì´ˆë§ˆë‹¤ ê²€ì‚¬í•˜ëŠ” ì„¤ì •
    healthcheck:
      test: ["CMD", "mysqladmin" ,"ping", "-h", "localhost"]
      interval: 5s
      timeout: 3s
      retries: 5

  # 2. FastAPI (íŒŒì´ì¬ ì„œë²„)
  api:
    build: .
    container_name: ootd-api
    ports:
      - "8000:8000"
    environment:
      # ğŸ‘‡ DB ì£¼ì†Œê°€ 'db' ì¸ì§€ 'mysql-container' ì¸ì§€ í™•ì¸í•˜ì„¸ìš”. 
      # (ì—¬ê¸°ì„œëŠ” ì„œë¹„ìŠ¤ ì´ë¦„ì¸ 'db'ë¥¼ ì”ë‹ˆë‹¤.)
      DATABASE_URL: mysql+pymysql://root:1234@db:3306/ootd_db
    # ğŸ‘‡ [ì¶”ê°€ë¨] "DBê°€ ê±´ê°•í•´ì§ˆ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì¼œì ¸ë¼!"
    depends_on:
      db:
        condition: service_healthy
    volumes:
      - .:/app

  # 3. í¬ë¡¤ëŸ¬ (apiì™€ ë™ì¼í•˜ê²Œ DB ê¸°ë‹¤ë¦¼)
  crawler:
    build: .
    container_name: ootd-crawler
    environment:
      DATABASE_URL: mysql+pymysql://root:1234@db:3306/ootd_db
    depends_on:
      db:
        condition: service_healthy